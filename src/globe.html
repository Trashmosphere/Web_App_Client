<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <!-- Include the CesiumJS JavaScript and CSS files -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.86/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.86/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style src="./css/globe.css"></style>
</head>

<body>
  <p id="testp">test</p>
  <div id="cesiumContainer"></div>
  <script>
    // Your access token can be found at: https://cesium.com/ion/tokens.
    // Replace `your_access_token` with your Cesium ion access token.

    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3MmJkYmFiMy0zNTIxLTRhMTctOGZkZC1jYTc1MmFmNzFhZTIiLCJpZCI6NjkxMDMsImlhdCI6MTYzMzE2NzA2Nn0.qB8RlADfiOvH4pspmgRhNSnCzpk0MwpO5HBVZYOggog';

    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain()
    });

    let isPossible=false;
    let lastX=0, difX=0;
    let lastY=0, difY=0;

    setInterval(()=>{
      isPossible=true;
    },10);

    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', (evt) => {
        if (lastX==0 && lastY==0)
        {
          lastX=-evt.alpha;
          lastY=-evt.gamma;
        }
        if (isPossible===true)
        {
        //Punem -beta pentru ca daca telefonul merge in stanga, alpha creste
        if (Math.abs(-evt.alpha-lastX)>10){
          difX=0;
          lastX=-evt.alpha;
        }
        else{
        difX=-evt.alpha-lastX;
      lastX=lastX+difX}

        //Punem -gamma, pentru ca gamma scade cand telefonul se orienteazaa in sus
        if(Math.abs(-evt.gamma-lastY)>10){
          difY=0;
          lastY=-evt.gamma;
        }
        else{
        difY=-evt.gamma-lastY;
        lastY=lastY+difY;
        }
        if (difX>0)
        {
          viewer.camera.lookRight(Cesium.Math.toRadians(difX));
        }
        else{
          viewer.camera.lookLeft(Cesium.Math.toRadians(-difX));
        }
        if(difY>0)
        {
          viewer.camera.lookUp(Cesium.Math.toRadians(difY));
        }
        else{
          viewer.camera.lookDown(Cesium.Math.toRadians(-difY));
        }
    

        isPossible=false;
      }
      }, false);
    }

    viewer.dataSources.add(
      Cesium.CzmlDataSource.load("getCZML")
    );
    // Fly the camera to San Francisco at the given longitude, latitude, and height.
    viewer.camera.setView({
      destination: Cesium.Cartesian3.fromDegrees(23.5736303, 46.751339, 800),
      orientation: {
        heading: Cesium.Math.toRadians(0.0),
        pitch: Cesium.Math.toRadians(0.0),
      }
    });
  </script>
  </div>
</body>

</html>